<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="adminMapper">
	
	<!-- MemberVO -->
	<resultMap type="Member" id="member_rm">
		<id property="memberNo" column="MEMBER_NO" />
		
		<result property="memberEmail" column="MEMBER_EMAIL" />
		<result property="memberPw" column="MEMBER_PW" />
		<result property="memberName" column="MEMBER_NAME" />
		<result property="memberBirth" column="MEMBER_BIRTH" />
		<result property="memberTel" column="MEMBER_TEL" />
		<result property="authority" column="AUTHORITY" />
		<result property="memberStatus" column="MEMBER_STATUS" />
		<result property="signUpDate" column="SIGNUP_DATE" />
		<result property="delDate" column="DEL_DATE" />
	</resultMap>
	
	<!-- GroupVO -->
	<resultMap type="Group" id="group_rm">
		<id property="groupNo" column="GROUP_NO" />
		
		<result property="topicCode" column="TOPIC_CODE" />
		<result property="groupName" column="GROUP_NAME" />
		<result property="groupDate" column="GROUP_DATE" />
		<result property="groupComment" column="GROUP_COMMENT" />
		<result property="openYN" column="OPEN_YN" />
		<result property="groupStatus" column="GROUP_STATUS" />
		<result property="topicName" column="TOPIC_NAME" />
		<result property="leaderName" column="LEADER_NAME" />
		<result property="memberCount" column="MEMBER_COUNT" />
		<result property="postCount" column="POST_COUNT" />
	</resultMap>
	
	<!-- Post VO -->
	<resultMap type="Post" id="post_rm">
		
		<id property="postNo" column="POST_NO" />
		
		<result property="memberNo" column="MEMBER_NO" />
		<result property="groupNo" column="GROUP_NO" />
		<result property="groupName" column="GROUP_NAME" />
		<result property="postContent" column="POST_CONTENT" />
		<result property="postView" column="POST_VIEW" />
		<result property="replyYN" column="REPLY_YN" />
		<result property="postDate" column="POST_DATE" />
		<result property="editDate" column="EDIT_DATE" />
		<result property="informYN" column="INFORM_YN" />
		<result property="postDelYN" column="POST_DEL_YN" />
		<result property="memberName" column="MEMBER_NAME" />
		<result property="memberImage" column="MEMBER_IMG" />
	</resultMap>
	
	<!-- 회원 목록 개수 조회 -->
	<select id="getMemberListCount" parameterType="string" resultType="_int">
		SELECT COUNT(*)
		FROM "MEMBER"
		WHERE ${condition}
	</select>
	
	<!-- 회원 목록 조회 -->
	<select id="selectMemberList" parameterType="string" resultMap="member_rm">
		SELECT MEMBER_NO, MEMBER_EMAIL, MEMBER_NAME, SIGNUP_DATE, MEMBER_STATUS
		FROM "MEMBER"
		WHERE ${condition}
		
		<!-- MEMBER_EMAIL LIKE '%' || #{keyword} || '%'
		OR  MEMBER_NAME LIKE '%' || #{keyword} || '%'
		OR  MEMBER_NO = #{keyword} -->
		
	</select>

	<!-- 회원 상세 조회 -->
	<select id="selectMemberDetail" parameterType="_int" resultMap="member_rm">
		SELECT MEMBER_NO, MEMBER_EMAIL, MEMBER_NAME, MEMBER_TEL, MEMBER_BIRTH, MEMBER_STATUS, SIGNUP_DATE, DEL_DATE
		FROM "MEMBER"
		WHERE MEMBER_NO = #{inputMemberNo}
	</select>
	
	<!-- 모임 목록 개수 조회 -->
	<select id="getGroupListCount" parameterType="string" resultType="_int">
		SELECT COUNT(*)
		FROM "GROUP"
		WHERE ${condition}
	</select> 
	
	<!-- 모임 목록 조회 -->
	<select id="selectGroupList" parameterType="string" resultMap="group_rm">
		SELECT GROUP_NO, TOPIC_NAME, GROUP_NAME, GROUP_DATE, OPEN_YN, GROUP_STATUS
		FROM "GROUP"
		JOIN "GROUP_TOPIC" USING(TOPIC_CODE)
		WHERE ${condition}
		<!-- GROUP_NAME LIKE '%' || #{keyword} || '%' -->
	</select>
	
	<!-- 모임 상세 조회 -->
	<select id="selectGroupDetail" parameterType="_int" resultMap="group_rm">
		SELECT GROUP_NO, TOPIC_NAME, GROUP_NAME, OPEN_YN, GROUP_STATUS, GROUP_COMMENT, GROUP_DATE,
				-- 리더 이름 --
				(SELECT MEMBER_NAME
				 FROM MEMBER_JOIN J
				 JOIN "MEMBER" USING(MEMBER_NO)
				 WHERE LEADER_YN = 'Y'
				 AND J.GROUP_NO = G.GROUP_NO) LEADER_NAME,
				 -- 회원 수 --
				(SELECT COUNT(*)
				 FROM MEMBER_JOIN J
				 WHERE JOIN_STATUS = 0
				 AND J.GROUP_NO = G.GROUP_NO) MEMBER_COUNT,
				 -- 게시글 수 --
				(SELECT COUNT(*)
				 FROM "POST" P
				 WHERE P.GROUP_NO = G.GROUP_NO) POST_COUNT
		FROM "GROUP" G
		JOIN "GROUP_TOPIC" USING(TOPIC_CODE)
		WHERE G.GROUP_NO = #{inputGroupNo}
	</select>
	
	<!-- 게시글 개수 조회 -->
	<select id="getPostListCount" parameterType="string" resultType="_int">
		SELECT COUNT(*)
		FROM "POST"
		JOIN "MEMBER" USING(MEMBER_NO)
		JOIN "GROUP" USING(GROUP_NO)
		WHERE ${condition}
	</select>
	
	<!-- 게시글 목록 조회 -->
	<select id="selectPostList" parameterType="string" resultMap="post_rm">
		SELECT POST_NO, MEMBER_NAME, GROUP_NAME, POST_DEL_YN,
		       TO_CHAR(POST_DATE, 'YYYY-MM-DD HH24:MI:SS') POST_DATE,
		       SUBSTR(POST_CONTENT, 0, 30) POST_CONTENT
		FROM "POST"
		JOIN "MEMBER" USING(MEMBER_NO)
		JOIN "GROUP" USING(GROUP_NO)
		WHERE ${condition}
		ORDER BY POST_NO
	</select>
	
	<!-- 게시글 상세 조회 -->
	<select id="selectPostDetail" parameterType="_int" resultMap="post_rm">
		SELECT POST_NO, GROUP_NO, GROUP_NAME, POST_DEL_YN, 
		       MEMBER_NO, MEMBER_NAME, 
		       TO_CHAR(POST_DATE, 'YYYY-MM-DD HH24:MI:SS') POST_DATE,
		       POST_CONTENT
		FROM "POST"
		JOIN "MEMBER" USING(MEMBER_NO)
		JOIN "GROUP" USING(GROUP_NO)
		WHERE POST_NO = ${inputPostNo}
	</select>
	
</mapper>
