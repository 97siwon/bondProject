<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="groupMapper">


	<resultMap type="Group" id="group_rm">
		
		<!-- PK 컬럼은 id로 -->
		<id property="groupNo" column="GROUP_NO" />
		
		<!-- 나머지 컬럼은 result로 작성 -->
		<result property="topicCode" column="TOPIC_CODE" />
		<result property="groupName" column="GROUP_NAME" />
		<result property="groupDate" column="GROUP_DATE" />
		<result property="groupImage" column="GROUP_IMG" />
		<result property="groupComment" column="GROUP_COMMENT" />
		<result property="openYN" column="OPEN_YN" />
		<result property="groupStatus" column="GROUP_STATUS" />
		<result property="memberCount" column="MEMBER_COUNT" />
	</resultMap>
	
	<select id="groupList" parameterType="Group" resultMap="group_rm">
		SELECT GROUP_NO, TOPIC_CODE, GROUP_NAME, GROUP_DATE, OPEN_YN, GROUP_STATUS
		FROM "GROUP"
	</select>
	
	<select id="selectMyGroup" parameterType="Member" resultMap="group_rm">
		SELECT G.GROUP_NO, GROUP_NAME, 
			(SELECT COUNT(*) FROM MEMBER_JOIN M
			WHERE M.GROUP_NO = G.GROUP_NO) MEMBER_COUNT,
			(SELECT GROUP_IMG_PATH || GROUP_IMG_RENAME FROM GROUP_IMG GI
			WHERE GI.GROUP_NO = G.GROUP_NO) GROUP_IMG
		FROM "GROUP" G
		JOIN MEMBER_JOIN M ON(M.GROUP_NO = G.GROUP_NO)
		WHERE MEMBER_NO = #{memberNo}
	</select>
	
	<select id="selectGroup" parameterType="_int" resultMap="group_rm">
		SELECT GROUP_NAME, GROUP_COMMENT,
			(SELECT COUNT(MEMBER_NO) FROM MEMBER_JOIN M
			WHERE M.GROUP_NO = G.GROUP_NO) MEMBER_COUNT,
			(SELECT GROUP_IMG_PATH || GROUP_IMG_RENAME FROM GROUP_IMG GI
			WHERE GI.GROUP_NO = G.GROUP_NO) GROUP_IMG
		FROM "GROUP" G
		WHERE GROUP_NO = #{groupNo}
	</select>
</mapper>
